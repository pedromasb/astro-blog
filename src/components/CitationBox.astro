---
import { toBibTeX } from "../utils/cite";
const {
  title,
  pubDate,
  authors = [],
  journal,
  volume,
  pages,
  doi,
  arxiv,
  url,
  bibtexOverride, // optional: put full BibTeX here to bypass generator
} = Astro.props;

const year = pubDate ? new Date(pubDate).getFullYear() : undefined;

const bib = bibtexOverride ?? toBibTeX({
  title, authors, year, journal, volume, pages, doi, arxiv, url
});

---
<section class="mt-5 border-gray-600 dark:border-gray-100 rounded-md border p-4">
  <h3 class="text-base m-1 p-1 font-semibold">Cite this work</h3>
  <div class="text-sm mt-1 text-gray-500 dark:text-gray-300">
    {authors?.map((a:any)=>a.name).join(", ")} ({year}). <em>{title}</em>{journal ? `. ${journal}` : ""}{volume ? `, ${volume}` : ""}{pages ? `:${pages}` : ""}{doi ? `. doi:${doi}` : ""}{arxiv ? `. arXiv:${arxiv}` : ""}.
  </div>
  <div class="mt-3 flex gap-2">
    {doi && <a class="rounded border px-3 py-1" href={`https://doi.org/${doi}`} rel="noopener" target="_blank">DOI</a>}
    {arxiv && <a class="rounded border px-3 py-1" href={`https://arxiv.org/abs/${arxiv}`} rel="noopener" target="_blank">arXiv</a>}
  </div>
  <details class="mt-3">
    <summary class="cursor-pointer select-none text-sm underline">Show BibTeX</summary>
    <pre class="mt-2 overflow-auto text-xs bg-transparent"><code>{bib}</code></pre>
  </details>
</section>
