import PostDetails from "@layouts/PostDetails.astro";
import { getCollection, type CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  // Get all non-draft posts
  const posts = await getCollection("blog", ({ data }) => !data.draft);

  // Generate a path per post, passing the post as a prop
  return posts.map((post) => ({
    params: { slug: post.slug },   // <-- important: must match /posts/<slug>/
    props: { post },
  }));
}

const { post } = Astro.props;
// Also pass all posts so PostDetails can build prev/next
const posts = await getCollection("blog", ({ data }) => !data.draft);
---

<PostDetails post={post} posts={posts} />