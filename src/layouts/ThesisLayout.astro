---
import { SITE } from "@config";
import Footer from "@components/Footer.astro";
import Header from "@components/Header.astro";
import Layout from "./Layout.astro";

export interface Props {
  title?: string;
  description?: string;
  frontmatter?: {
    title: string;
    description?: string;
  };
}

const { title, description, frontmatter } = Astro.props;

const pageTitle = (title ?? frontmatter?.title ?? "Doctoral Thesis");
const pageDesc  = (description ?? frontmatter?.description ?? "PhD thesis — details and abstract");
---

<Layout title={`${pageTitle} | ${SITE.title}`} description={pageDesc}>
  <Header activeNav="thesis" />

  <main id="main-content" class="mx-auto max-w-5xl px-4 sm:px-6 py-8 sm:py-12">
    <!-- Title formatted like other pages -->
    <header class="mb-6 sm:mb-8">
      <h1 class="text-2xl mt-5 tracking-wider sm:text-3xl">{pageTitle}</h1>
      {pageDesc && <p class="mt-2 text-sm sm:text-base text-skin-muted">{pageDesc}</p>}
    </header>

    <!-- Two-column split: meta (left) | abstract (right) -->
    <section class="grid gap-6 lg:grid-cols-5 mb-10">
      <!-- Meta card -->
      <aside class="lg:col-span-2 rounded-2xl border border-skin-line/40 bg-skin-card/80 shadow-sm">
        <div class="p-5 sm:p-6">
          <slot name="meta" />
        </div>
      </aside>

      <!-- Abstract card (scrollable) -->
      <article
        class="lg:col-span-3 rounded-2xl border border-skin-line/40 bg-skin-card/80 shadow-sm"
        aria-labelledby="abstract-heading"
      >
        <div class="p-5 sm:p-6">
          <h2 id="abstract-heading" class="text-xl sm:text-2xl font-semibold mb-3">Abstract</h2>

          <!-- Scrollable region -->
          <div
            role="region"
            aria-label="Abstract content"
            class="max-h-[28rem] overflow-y-auto pr-1 font-serif leading-relaxed"
          >
            <slot name="abstract" />
          </div>
        </div>
      </article>
    </section>

    <!-- Retro-minimal “Talk with my thesis” -->
    <section class="rounded-2xl border-2 border-skin-line bg-transparent shadow-none">
      <div class="p-4 sm:p-5">
        <h2 class="text-xl sm:text-2xl font-semibold mb-3">Talk with my thesis</h2>

        <!-- Retro wrapper applies minimal/monospace styles to the widget -->
        <div class="thesis-chat font-mono text-[0.95rem]">
          <slot name="chat" />
        </div>
      </div>
    </section>

    <!-- Back-compat: any extra content -->
    <section class="prose prose-neutral dark:prose-invert max-w-none mt-10">
      <slot />
    </section>
  </main>

  <Footer />
</Layout>

<style>
  /* Retro-minimal overrides inside the chat wrapper (no icons, no background) */
  .thesis-chat :is(input, textarea) {
    @apply font-mono bg-transparent border border-skin-line rounded-none px-3 py-2 outline-none;
  }
  .thesis-chat button {
    @apply font-mono border border-skin-line rounded-none px-3 py-2 bg-transparent hover:underline;
  }
  .thesis-chat .prose p {
    @apply leading-relaxed;
  }

  /* Optional: subtler look for the card edges on dark/light */
  .thesis-chat,
  .thesis-chat * {
    text-shadow: none;
    box-shadow: none;
  }

  /* Tighter scrollbars for the abstract area (where supported) */
  @supports selector(::-webkit-scrollbar) {
    article [role="region"]::-webkit-scrollbar { width: 8px; }
    article [role="region"]::-webkit-scrollbar-thumb {
      background: color-mix(in oklab, currentColor 20%, transparent);
      border-radius: 8px;
    }
  }
</style>
